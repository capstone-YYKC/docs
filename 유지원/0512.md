
# 로그인 마무리

```jsx
  const [formData, setFormData] = useState({
    email: '',
    password: '',
  })

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,  
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try{
      const response = await axios.post('http://localhost:3000/signin', formData); //서버에 데이터 전송
      console.log('Sending data to server', formData); //데이터 확인
      console.log(response);

      if(response.data.code == 200){
        console.log('Login successful');
        localStorage.setItem("userToken", response.data.result.token);
        const userToken = localStorage.getItem("userToken");
        console.log(userToken);
        navigate('/main'); //메인 페이지로 이동
        
      } else {
        console.log('Login failed');
      }

    } catch (error){
      console.error('Error submitting form: ', error);
    }
  }
```

 수용님과 로그인 데이터 주고 받기 완료했고, 받은 코드 200으로 로그인 성공했을 때 다음 페이지로 넘어가는 걸 구현했다.

- 오류
    - response 코드가 200번만 와요
        
        문제: 로그인 정보를 보내서 확인을 요청하고 response를 받았는데, code가 200번만 왔다.
        
        해결: 200번은 서버에 데이터가 전달 완료됐다는 뜻이었고, data 안에 있는 code가 로그인 정보에 대한 code였다! 잘 전달되는 것을 확인했다.
        
    - 토큰은 어디에 저장해서 쓰지
        
        문제: 서버에서 data 안에 토큰을 넣어서 보내주는데, 페이지가 넘어가면 어떻게 토큰을 계속 사용하게 할지?
        
        해결: 로컬 스토리지에 넣어서 쓸 때마다 불러서 서버 요청할 때 같이 보내서 요청하면 된다!
        
        ```jsx
                //로그인 성공하면 토큰 저장
                localStorage.setItem("userToken", response.data.result.token);
                const userToken = localStorage.getItem("userToken");
        ```
        
        ```jsx
        //토큰 사용할 때
          const userToken = localStorage.getItem("userToken");
          console.log('토큰', userToken);
        
          useEffect(() => {
            axios.get('http://localhost:3000/diarys', {
              headers: {
                'x-access-token': userToken
              }
            })
                .then(response => {
                  console.log('일기 정보', response.data)
                  setdate0(response.data[0].emotionScore);
                  setdate1(response.data[1].emotionScore);
                  setdate2(response.data[2].emotionScore);
                });
          }, []);
        ```
        

# 로그인 성공 후 메인 페이지에서 데이터 받고 표시

```jsx
  const [date0, setdate0] = useState([]);
  const [date1, setdate1] = useState([]);
  const [date2, setdate2] = useState([]);
  const [date3, setdate3] = useState([]);
  const [date4, setdate4] = useState([]);
  const [date5, setdate5] = useState([]);
  const [date6, setdate6] = useState([]);
  

  const userToken = localStorage.getItem("userToken");
  console.log('토큰', userToken);

  useEffect(() => {
    axios.get('http://localhost:3000/diarys', {
      headers: {
        'x-access-token': userToken
      }
    })
        .then(response => {
          console.log('일기 정보', response.data)
          setdate0(response.data[0].emotionScore);
          setdate1(response.data[1].emotionScore);
          setdate2(response.data[2].emotionScore);
          setdate3(response.data[3].emotionScore);
          setdate4(response.data[4].emotionScore);
          setdate5(response.data[5].emotionScore);
          setdate6(response.data[6].emotionScore);
        });
  }, []);
```

서버로 요청 + 토큰을 보내면 일기 데이터를 전송받는다!

setdate6(response.data[6].emotionScore); 를 통해 date6에 정보를 넣고 그래프에 표시한다.

- 결과
    
    ![그래프결과.png](https://github.com/capstone-YYKC/docs/blob/main/%EC%9C%A0%EC%A7%80%EC%9B%90/image/%EA%B7%B8%EB%9E%98%ED%94%84%EA%B2%B0%EA%B3%BC.png)
    
- 오류
    - axios.post로 불러온 정보들이 안보여요
        
        문제: [`axios.post`](http://axios.post)는 비동기함수로, 다른 함수들과 따로 조금 늦게 돌아간다. 따라서, 정보를 받아오기 전에 그래프가 이미 다 표시되어 버려서 뒤늦게 데이터가 도착해 데이터를 표시하지 못했던 것이다..
        
        해결: `useEffect()`는 렌더링 도중에 실행되는 함수로 그래프가 다 표시되기 전에 실행된다! 그 안에서 `useState()`를 사용해서 데이터를 변수에 넣어줘서 표시했더니 잘 떴다!
        

## 해야할 것

1. 일기 속 감정에 따라 날짜 색상 변경 (O)
2. 일기 모달 열면 해당 날짜의 일기+요약+위로의 말이 나오는 것 (△) → 테스트 진행해야 

# 감정에 따라 날짜 색상 변경

```jsx
  const userToken = localStorage.getItem("userToken");
  const [imageSrc, setImageSrc]=useState('/day19.svg');

 //기분에 따른 색상 변화
  useEffect(() => {
    async function fetchData() {
      axios.get('http://localhost:3000/diarys', {
        headers: {
          'x-access-token': userToken
        }
      })
          .then(response => {
            console.log('일기 감정', response.data[0].emotionStatus)
            const mood = response.data[0].emotionStatus;
            console.log(mood);
            //1: 슬픔, 2: 기쁨, 3: 화남
            switch(mood){
              case '슬픔':
                setImageSrc('/day191.svg');
                break;
              case '행복':
                setImageSrc('/day192.svg');
                break;
              case '화남':
                setImageSrc('/day193.svg');
                break;
              default:
                setImageSrc('/day19.svg');
            }
          }
        );

    }

    fetchData();
  }, []);
```

1. 서버가 보내주는 response에서 날짜별 `emitionStatus`를 가져온다.
2. 가져온 데이터를 변수 **mood**에 넣어준다.
3. mood의 값에 따라 날짜의 색상을 바꿔준다. (조건부 switch, 보통이나 작성하지 않았을 경우 기본 색상)

걱정되는 점: 로딩이 좀 오래 걸리긴 한다.

# 모달에 일기 정보 띄우기

```jsx
import styles from "./DiaryCheckPopup_1.module.css";
import axios from 'axios';
import React, {useState, useEffect} from 'react';

const DiaryCheckPopup = () => {

  //일기 내용
  const [content, setContent]=useState('');
  //일기 요약
  const [summary, setSummary]=useState('');
  //위로의 말
  const [consolation, setConsolation]=useState('');

  //const ex = '안녕안녕 화이팅!';

  const userToken = localStorage.getItem("userToken");
  console.log('토큰', userToken);

  useEffect(() => {
    axios.get('http://localhost:3000/diarys', {
      headers: {
        'x-access-token': userToken
      }
    })
        .then(response => {
           setContent(response.data[0].content); 
           setSummary(response.data[0].summary);
           setConsolation(response.data[0].console);
        });
  }, []);

  return (
    <div className={styles.diaryCheckPopup}>
      <div className={styles.div}>5월 19일 일기</div>
      <div className={styles.diaryCheckPopupChild}></div>
      <div className={styles.content}>{content}</div>
      <div className={styles.diaryCheckPopupItem} />
      <div className={styles.diaryCheckPopupInner}></div>
      <div className={styles.div1}>{summary}</div>
      <img className={styles.polygonIcon} alt="" src="/polygon-7.svg" />
      <div className={styles.div2}>{'곰곰이: '} {consolation}</div>
      <img className={styles.icon} alt="" src="/-1@2x.png" />
    </div>
  );
};

export default DiaryCheckPopup;

```

1. 서버에서 데이터를 받아와서 setState로 `content`에 저장한다.
2. 저장한 데이터를 return 쪽에 content 박스 안에 추가하여 표시한다.

```jsx
.diaryCheckPopupChild,
.content
{
  position: relative;
  top: 40px;
  left: 40px;
  border-radius: var(--br-3xs) var(--br-3xs) 0 0;
  background-color: var(--color-snow-100);
  width: 538px;
  height: 483px;
  z-index: 0;
}
.content{
  position: absolute;
  top: 140px;
  left: 40px;
  height: 396px;
  width: 518px;
  background-color: var(--color-snow-100);
  z-index: 1;
  padding: 10px;
  overflow-y: auto;
}
```

1. 뒷 배경 위에 일기 내용을 올리려면 두 요소를 **부모, 자식** 관계로 만들어야 한다.
2. `z-index`로 뒷배경이 아래, 내용이 위로 설정해준다.
3. `overflow-y`는 상자 안에 내용이 길어지면 스크롤로 내려볼 수 있게 해준다.
4. `padding`할 경우, 상자의 크기가 커지게 되니 사이즈 조절을 해줘야 한다.

이 외에 요약 내용을 띄울 때 내용이 중앙에 위치하고, 다른 요소들을 움직이지 않게 수정했다.

학교에서 수용님과 서버 연결을 해서 테스트할 예정이다.

테스트에서 걱정되는 점은 다음과 같다.

1. 요약 길이가 너무 길어버리면 어떻게 할까
2. 정보를 받아서 표시했는데 요소들이 밀려나면 어쩌지
