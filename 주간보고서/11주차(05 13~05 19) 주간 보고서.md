# 11ì£¼ì°¨(05.13~05.19) ì£¼ê°„ ë³´ê³ ì„œ

# í™œë™ ë‚´ì—­

# 1. í”„ë¡ íŠ¸ì—”ë“œ

## 1-1. ì¼ê¸° ë‚´ìš© ë°ì´í„° ì „ì†¡ ì™„ë£Œ

![Untitled](https://github.com/capstone-YYKC/docs/assets/109731614/5ece73fe-cf9c-467a-9fa0-019d98e3f1de)

- ë¬¸ì œ ì—†ì´ ë°ì´í„°ë¥¼ ë°›ì•„ì„œ í‘œì‹œí•˜ëŠ” ê²ƒì„ ì™„ë£Œí–ˆë‹¤!
- ì‚´ì§ ë²„ë²…ì„ì´ ìˆì–´ì„œ ì‹œê°„ì´ ëœë‹¤ë©´ ì´ìª½ë„ ìµœì í™”ë¥¼ í•´ì£¼ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

## 1-2. ìµœì í™”1

### ë¬¸ì œ

1. getì„ ë„ˆë¬´ ë§ì´ ìš”ì²­í•´ì„œ ë Œë”ë§ì´ ë²„ë²…ì¸ë‹¤. (í•´ê²°)
2. ê·¸ë˜í”„ê°€ ì• ë‹ˆë©”ì´ì…˜ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ”ë‹¤. (í•´ê²°)

### ë‹¤ëŸ‰ì˜ get ìš”ì²­

í•´ê²°ë°©ë²•: main í˜ì´ì§€ì—ì„œ ë°›ì€ ì¼ê¸° ì •ë³´ì—ì„œ í•„ìš”í•œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬í•´ì¤€ë‹¤.

```jsx
  //ì •ë³´ ìš”ì²­ ë¶€ë¶„(ë©”ì¸)
  useEffect(() => {
    axios.get('http://18.211.120.39:3000/diarys', {
      headers: {
        'x-access-token': userToken
      }
    })
        .then(response => {
          console.log('ì¼ê¸° ì •ë³´', response.data);
          const scores = response.data.map(entry => entry.emotionScore);
          const status = response.data.map(entry => entry.emotionStatus);
          setdates(scores);
          setstatuses(status);   
          console.log('ê°ì • ì ìˆ˜', scores);
          console.log('ê°ì • ìƒíƒœ', statuses);
        });
  }, [userToken]);
```

```jsx
//ì»´í¬ë„ŒíŠ¸ë¡œ ì •ë³´ ì „ë‹¬(ë©”ì¸)
<Day19Icon propTop="460px" propLeft="36px" diaryStatus={statuses[0]}/>
```

```jsx
//ì „ë‹¬ëœ ì •ë³´ ì²˜ë¦¬(ì»´í¬ë„ŒíŠ¸)
const Day19Icon = memo(({ propTop, propLeft, diaryStatus }) => {
  const [isDiaryCheckPopupOpen, setDiaryCheckPopupOpen] = useState(false);
  const openDiaryCheckPopup = useCallback(() => {
    setDiaryCheckPopupOpen(true);
  }, []);
  const closeDiaryCheckPopup = useCallback(() => {
    setDiaryCheckPopupOpen(false);
  }, []);

  const [imageSrc, setImageSrc]=useState('/day19.svg');

  
  const day19IconStyle = useMemo(() => {
    return {
      top: propTop,
      left: propLeft,
    };
  }, [propTop, propLeft]);

  //1: ìŠ¬í””, 2: ê¸°ì¨, 3: í™”ë‚¨
  useEffect(() => {
    switch(diaryStatus){
      case 'ìŠ¬í””':
        setImageSrc('/day191.svg');
        break;
      case 'í–‰ë³µ':
        setImageSrc('/day192.svg');
        break;
      case 'í™”ë‚¨':
        setImageSrc('/day193.svg');
        break;
      default:
        setImageSrc('/day19.svg');
    }
  }, [diaryStatus]);

  return (
    <>
      <img
        className={styles.day19Icon}
        alt=""
        src={imageSrc}
        style={day19IconStyle}
        onClick={openDiaryCheckPopup}
      />
      {isDiaryCheckPopupOpen && (
        <PortalPopup
          overlayColor="rgba(113, 113, 113, 0.3)"
          placement="Centered"
          onOutsideClick={closeDiaryCheckPopup}
        >
          <DiaryCheckPopup onClose={closeDiaryCheckPopup} />
        </PortalPopup>
      )}
    </>
  );
});

export default Day19Icon;

```

ê²°ê³¼: ë”°ë¡œë”°ë¡œ ë˜ì–´ì„œ ë²„ë²…ì´ë˜ ë Œë”ë§ì´ í•œ ë²ˆì— ì²˜ë¦¬ë˜ì—ˆë‹¤!

### 2. ê·¸ë˜í”„ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€

- í•´ê²°ë°©ë²• 1

**useEffect ë‚´ì—ì„œ ì˜ì¡´ì„± ë°°ì—´ì„ ì—…ë°ì´íŠ¸í•´ì„œ, ì´ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§Œ ì‹¤í–‰ë˜ê²Œ í•˜ê¸°**

```jsx
  useEffect(() => {
    axios.get('http://18.211.120.39:3000/diarys', {
      headers: {
        'x-access-token': userToken
      }
    })
        .then(response => {
          console.log('ì¼ê¸° ì •ë³´', response.data);
          const scores = response.data.map(entry => entry.emotionScore);
          const status = response.data.map(entry => entry.emotionStatus);
          setdates(scores);
          setstatuses(status);   
          console.log('ê°ì • ì ìˆ˜', scores);
          console.log('ê°ì • ìƒíƒœ', statuses);
        });
  }, [userToken]);
```

- í•´ê²°ë°©ë²•2

**memoë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ë¦¬ë Œë”ë§ í•˜ë„ë¡ í•˜ê¸°**

`const Day21Icon = memo(({ propTop, propLeft, diaryStatus }) *=> â€¦*`

- í•´ê²°ë°©ë²• 3

**ê·¸ë˜í”„ë¥¼ ê·¸ë¦´ ë•Œ ì¡°ê±´ì„ ê±¸ì–´ì„œ ì»´í¬ë„ŒíŠ¸ê°€ ëª¨ë‘ ë³€ê²½ëœ ë’¤ì— ê·¸ë˜í”„ ë‚˜íƒ€ë‚˜ê²Œ í•˜ê¸° â†’ ì´ê²Œ ê°€ì¥ íš¨ê³¼ê°€ ìˆì—ˆë‹¤.**

```jsx
        <div>
          {statuses.length > 0 && (
          <LineChart
            className={styles.Chart}
            width={776}
            height={410}
            data={data}
            margin={{
              top: 5,
              right: 30,
              left: 20,
              bottom: 5,
            }}
          > 
            <XAxis dataKey="day" tickLine={false} stroke='' />
            <Tooltip formatter={formatTooltip}/>
            <Legend />
            <Line type="monotone" dataKey="ê°ì •ì ìˆ˜" stroke="#4B443B" activeDot={{ r: 6 }}/>
          </LineChart>
          )}
        </div>
```

ê²°ê³¼: í•´ê²°ë°©ë²•ì„ ëª¨ë‘ ì‹¤í–‰í–ˆì„ ë•Œ, ì• ë‹ˆë©”ì´ì…˜ì´ ë‹¤ì‹œ ë‚˜íƒ€ë‚œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

## 1-3. ì¼ê¸° í™•ì¸ ëª¨ë‹¬ ë””ìì¸ ë³€ê²½

![Untitled 1](https://github.com/capstone-YYKC/docs/assets/109731614/ab3c441d-2604-4961-ae65-53966526f5cc)

1. ë‚ ì§œ í˜•íƒœ: 5ì›” 19ì¼ â†’ 2024-05-19ë¡œ ë³€ê²½
2. ìš”ì•½ ì •ë³´: ìš”ì•½ ë³´ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìš”ì•½ ëª¨ë‹¬ì´ ë– ì„œ í™•ì¸ ê°€ëŠ¥ ë°”ê¹¥ì„ ëˆ„ë¥´ë©´ êº¼ì§

+ê°„ê²© ìˆ˜ì •

## 1-4. ìµœì í™” 2

ë¬¸ì œ: ë‚ ì§œë¥¼ ëˆŒë €ì„ ë•Œ ê²°ê³¼ê°€ ë³´ì´ëŠ” ì†ë„ê°€ ëŠë ¸ë‹¤. (ë²„ë²…ì„) ì™œëƒí•˜ë©´, ëª¨ë‹¬ ì•ˆì—ì„œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•´ì„œ í‘œì‹œí–ˆê¸° ë•Œë¬¸ì´ë‹¤.

í•´ê²°ë°©ë²•: ë©”ì¸ì— ì ‘ì†í•  ë•Œ ì²˜ìŒ ë¶€ë¥¸ ë°ì´í„°ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ëª¨ë‹¬ë¡œ ì „ë‹¬í•´ì¤¬ë‹¤. (ë©”ì¸ â†’ ë‚ ì§œ ì»´í¬ë„ŒíŠ¸ â†’ ì¼ê¸° ëª¨ë‹¬ â†’ ìš”ì•½ ëª¨ë‹¬)

```jsx
//main.jsx
//ì»´í¬ë„ŒíŠ¸ì— ë°ì´í„° ì „ë‹¬
<Day20Icon propTop="460px" propLeft="36px" diaryStatus={statuses[0]} diaryContent={contents[0]} diaryConsolation={consolations[0]} diarySummary={summaries[0]}/>
```

```jsx
//Day20Icon.jsx
//Status ì‚¬ìš© í›„ ë‚˜ë¨¸ì§€ ë°ì´í„° ëª¨ë‹¬ë¡œ ì „ë‹¬
const Day20Icon = memo(({ propTop, propLeft, diaryStatus, diaryContent, diaryConsolation, diarySummary}) => {
  const [isDiaryCheckPopupOpen, setDiaryCheckPopupOpen] = useState(false);
  const openDiaryCheckPopup = useCallback(() => {
    setDiaryCheckPopupOpen(true);
  }, []);
  const closeDiaryCheckPopup = useCallback(() => {
    setDiaryCheckPopupOpen(false);
  }, []);

  const [imageSrc, setImageSrc]=useState('/day20.svg');

  
  const day20IconStyle = useMemo(() => {
    return {
      top: propTop,
      left: propLeft,
    };
  }, [propTop, propLeft]);

  //1: ìŠ¬í””, 2: ê¸°ì¨, 3: í™”ë‚¨
  useEffect(() => {
    switch(diaryStatus){
      case 'ìŠ¬í””':
        setImageSrc('/day201.svg');
        break;
      case 'í–‰ë³µ':
        setImageSrc('/day202.svg');
        break;
      case 'í™”ë‚¨':
        setImageSrc('/day203.svg');
        break;
      default:
        setImageSrc('/day20.svg');
    }
  }, [diaryStatus]);

  return (
    <>
      <img
        className={styles.day20Icon}
        alt=""
        src={imageSrc}
        style={day20IconStyle}
        onClick={openDiaryCheckPopup}
      />
      {isDiaryCheckPopupOpen && (
        <PortalPopup
          overlayColor="rgba(113, 113, 113, 0.3)"
          placement="Centered"
          onOutsideClick={closeDiaryCheckPopup}
        >
          <DiaryCheckPopup onClose={closeDiaryCheckPopup} diaryContent={diaryContent} diaryConsolation={diaryConsolation} diarySummary={diarySummary}/>
        </PortalPopup>
      )}
    </>
  );
});

export default Day20Icon;

```

```jsx
//DiaryCheckPopup_1.jsx
//ë°ì´í„° í‘œì‹œ
  const [isSummaryModalOpen, setSummaryModalOpen] = useState(false);
  const openSummaryModal = useCallback(() => {
    setSummaryModalOpen(true);
  }, []);
  const closeSummaryModal = useCallback(() => {
    setSummaryModalOpen(false);
  }, []);

  return (
    <div className={styles.diaryCheckPopup}>
      <div className={styles.div}>2024-05-19</div>
      <div className={styles.diaryCheckPopupChild}></div>
      <div className={styles.content}>{diaryContent}</div>
      <div className={styles.diaryCheckPopupItem} />
      <div className={styles.diaryCheckPopupInner} onClick={openSummaryModal} ></div>
      <div className={styles.div1}onClick={openSummaryModal}>ìš”ì•½ ë³´ê¸°</div>
      <div className={styles.div2}>{'ê³°ê³°ì´: '} {diaryConsolation}</div>
      <img className={styles.icon} alt="" src="/-1@2x.png" />
      {isSummaryModalOpen && (
        <PortalPopup
          
          placement="Centered"
          onOutsideClick={closeSummaryModal}
        >
          <SummaryModal onClose={closeSummaryModal} diarySummary={diarySummary}/>
        </PortalPopup>
      )}
    </div>
  );
};

export default DiaryCheckPopup;

```

```jsx
//SummaryModal.jsx
//ìƒˆë¡œìš´ ëª¨ë‹¬ ì¶”ê°€
import styles from "./SummaryModal.module.css";
import axios from 'axios';
import React, {useState, useEffect} from 'react';

const SummaryModal = ({diarySummary}) => {
  return (
    <div className={styles.SummaryModal}>
      <div className={styles.div}>{diarySummary}</div>

    </div>
  );
};

export default SummaryModal;

```

ëª©í‘œ: ë‚ ì§œ í•˜ë‚˜ ë‹¹ ëª¨ë‹¬ í•˜ë‚˜ë¡œ ëª¨ë‹¬ ìˆ˜ë¥¼ ëŠ˜ë¦¬ì§€ ë§ê³ , ëª¨ë‹¬ í•˜ë‚˜ë¡œ ì—¬ëŸ¬ ë‚ ì§œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒ

ë‹¤ìŒì— í•´ì•¼ í•  ê²ƒ: ë‚ ì§œ ë°ì´í„° ë°›ì•„ì„œ ê°€ê³µí•´ì„œ í‘œì‹œí•˜ê¸°

## 1-5. ìˆ˜ì • ì‚¬í•­

![Untitled 2](https://github.com/capstone-YYKC/docs/assets/109731614/d09ebc73-8aff-45e2-92d4-c8bfb34a2b05)

1. ë‚ ì§œ í‘œì‹œë¥¼ ë‹¤ì‹œ `ëª‡ì›” ëª‡ì¼ ì¼ê¸°`ë¡œ ë°”ê¿¨ë‹¤.
2. diaryDay ë³€ìˆ˜ë¥¼ í†µí•´ ìœ„ì˜ í˜•íƒœë¡œ ì „ë‹¬í•œë‹¤.
3. ì¼ê¸° ì •ë³´ ëª¨ë‹¬ì—ì„œ ë‚ ì§œ í‘œì‹œë¥¼ ì¤‘ì•™ ì •ë ¬ë¡œ ë°”ê¾¸ê³  í”½ì…€ì„ ì¡°ì •í–ˆë‹¤.

í”„ë¡ íŠ¸ ë§ˆë¬´ë¦¬ ì™„ë£Œ!

## 1-6. ì¶”ê°€ì ì¸ ê¸°ëŠ¥ ê°œë°œ

ì™¼ìª½ ì•„ë˜ì— ì›”ë³„ í‰ê·  ì ìˆ˜ì™€ ì´ë²ˆ ë‹¬ì— ê¸°ì¨, ìŠ¬í””, í™”ë‚¨ ê°ì •ì„ ëª‡ ë²ˆ ëŠê¼ˆëŠ”ì§€, ê°„ë‹¨í•œ ë©˜íŠ¸ë¥¼ í‘œì‹œí•´ì£¼ëŠ” ê³³ì´ ìˆë‹¤. ì´ê±¸ ê°„ë‹¨í•˜ê²Œ í‘œì‹œí•´ë³´ë ¤ê³  í•œë‹¤.

### ì›”ë³„ ê°ì •ì„ ëŠë‚€ íšŸìˆ˜

```jsx
  //
  const countStatuses = statuses.reduce((acc, status) => {
    acc[status] = (acc[status] || 0) + 1;
    return acc;
  }, {});
  //ê²°ê³¼: {ìŠ¬í””: , í–‰ë³µ: , í™”ë‚¨: , ë³´í†µ:  }
```

![Untitled 3](https://github.com/capstone-YYKC/docs/assets/109731614/b40737d8-a679-4b3f-acdd-c1ccb48939b1)

### ì›”ë³„ í‰ê·  ì ìˆ˜

```jsx
  const sum = dates.reduce((total, date) => total + date, 0);
  const average = Math.floor(sum / dates.length);
```

### ì›”ë³„ ê°ì •ì— ë”°ë¥¸ ê°„ë‹¨í•œ ìœ„ë¡œì˜ ë§

```jsx
		      for (const countStatus in countStatuses) {
            if (countStatuses[countStatus] > maxCount) {
              maxCount = countStatuses[countStatus];
              maxEmotion = countStatus;
            }else if (countStatuses[countStatus] === maxCount) {
              maxEmotion = " ";
            }
          }
        
          if (maxEmotion === "í™”ë‚¨") {
            setMonthConsole('í™”ë‚œ ê°ì •ì´ ë“ì–´ì˜¤ë¥´ëŠ” ë‚ , ê·¸ ë§ˆìŒì„ ì´í•´í•´. ê°ì •ì˜ íŒŒë„ê°€ ì¡°ê¸ˆì€ ë” í¬ê²Œ ë‹¤ê°€ì˜¤ëŠ” ê²ƒì²˜ëŸ¼ ëŠê»´ì§ˆì§€ë„ ëª°ë¼. í•˜ì§€ë§Œ ê·¸ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê²ƒì€ ì •ë§ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ê³ , ì´ëŸ° ê°ì •ì´ ì˜¤ê³ ê°€ëŠ” ê²ƒì€ ë„ˆê°€ ì„±ì¥í•˜ê³  ë³€í™”í•˜ê³  ìˆë‹¤ëŠ” ì¦ê±°ë¼ëŠ” ê±¸ ìŠ¤ìŠ¤ë¡œ ë¯¿ì–´ì¤˜. í™”ë‚œ ê°ì •ì€ ê¸ˆë°© ì§€ë‚˜ê°ˆ ê±°ì•¼. ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆì–´. ì–¸ì œë“ ì§€ ë„ˆì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì¤„ê²Œ.');
          } else if (maxEmotion === "ìŠ¬í””") {
            setMonthConsole('ë„ˆê°€ ìš°ìš¸í•œ ë‚ ì„ ë³´ë‚¸ë‹¤ëŠ” ê±´ ì •ë§ ìŠ¬í”ˆ ì¼ì´ì•¼. ê·¸ ê°ì •ì´ ë„ˆë¥¼ ì–´ë‘  ì†ìœ¼ë¡œ ëŒì–´ë‚´ë¦¬ëŠ” ê²ƒ ê°™ì„ì§€ë„ ëª°ë¼. ê·¸ë˜ë„ ë‚œ í•­ìƒ ë„ˆì™€ í•¨ê»˜ì•¼. ë§ˆìŒì´ ì•„í”„ê³  ì–´ë ¤ìš´ ë‚ ì´ì—ˆì§€ë§Œ, ë„ˆëŠ” ì´ê²¨ë‚¼ ìˆ˜ ìˆì„ê±°ì•¼. ì´ëŸ° ê°ì •ì„ ëŠê»´ë„, ëŠë¼ì§€ ì•Šì•„ë„ ë„Œ ê°•í•˜ê³  ì†Œì¤‘í•œ ì‚¬ëŒì´ë‹ˆê¹Œ. ê°ì •ì˜ íŒŒë„ì— íœ©ì“¸ë ¤ ë– ë‚´ë ¤ê°€ëŠ” ê±¸ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆ. ê·¸ ê¸¸ì— ë‚´ê°€ í•¨ê»˜í• ê²Œ.');
          } else if (maxEmotion === "í–‰ë³µ") {
            setMonthConsole('ë„ˆê°€ í–‰ë³µí•œ ë‚ ì„ ë³´ë‚´ì„œ ë‚˜ë„ ì •ë§ ê¸°ë». ê·¸ëŸ° ìˆœê°„ì€ ë§ˆìŒì´ ê°€ë²¼ì›Œì§€ê³  í¬ë§ì´ ë„˜ì³ íë¥´ëŠ” ê²ƒ ê°™ì§€ ì•Šì•„? ê·¸ ê°ì •ì„ ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ„ëŠ” ê²ƒë„ ì •ë§ í–‰ë³µí•œ ì¼ì´ì§€. ë¬¼ë¡  ë‚˜í•œí…Œë„ ë§ì´ì•¼! í•˜ì§€ë§Œ ê°€ë” í–‰ë³µì´ ë‘ë ¤ìš¸ ìˆ˜ ìˆì–´. ì´ í–‰ë³µì´ ì–¸ì œê¹Œì§€ ê°ˆì§€, ë¬´ì—‡ì´ ë‚  ë˜ í˜ë“¤ê²Œ í• ì§€ ê°™ì€ ìƒê° ë§ì´ì•¼. ê·¸ë ‡ì§€ë§Œ, í–‰ë³µí•œ ìˆœê°„ì„ ë°›ì•„ë“¤ì´ê³  ì¦ê¸°ëŠ” ê²ƒë„ ì •ë§ ì¤‘ìš”í•´! ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆì„ê²Œ. í–‰ë³µì´ ìˆë‹¤ë©´ ì–¸ì œë‚˜ ì´ì•¼ê¸°í•˜ëŸ¬ ì™€ì¤˜.');
          } else if (maxEmotion === "ë³´í†µ") {
            setMonthConsole('ë‚˜ëŠ” í‰ë²”í•œ ë‚ ì„ ë³´ë‚¼ ë•Œë©´, ì˜¤íˆë ¤ ê·¸ ë‚ ì´ íŠ¹ë³„í•œ ë‚ ì´ë¼ê³  ìƒê°í•˜ê³¤ í•´. ê·¸ëŸ° ë‚ ì—ëŠ” ì¼ìƒì˜ ì†Œì¤‘í•¨ì„ ëŠë¼ê³ , í¸ì•ˆí•¨ì„ ì°¾ì„ ìˆ˜ ìˆê±°ë“ . í‰ë²”í•œ ë‚ ì—ëŠ” ìƒê°ë³´ë‹¤ ì†Œì¤‘í•œ ê²ƒì´ ê°€ë“í•´. ì¹œêµ¬ë“¤ê³¼ì˜ ëŒ€í™”, ê°€ì¡±ê³¼ì˜ ì‹œê°„, ë§›ìˆëŠ” ìŒì‹, ì‚°ì±…í•  ë•Œì˜ ë°”ëŒ ê°™ì€ ì†Œì†Œí•˜ê³  ì‘ì€ í–‰ë³µë“¤ ë§ì´ì•¼. ê·¸ëŸ¬ë‹ˆê¹Œ ì˜¤ëŠ˜ ë„ˆë„ í‰ë²”í•œ ë‚ ì„ íŠ¹ë³„í•œ ë‚ ë¡œ ìƒê°í•´ë´! ì‘ì€ í–‰ë³µë“¤ì„ ì°¾ì•„ì„œ ìƒˆê²¨ë³´ëŠ” ê±°ì•¼. ê·¸ëŸ¬ë©´ í‰ë²”í–ˆë˜ ë‚ ì´ ë‚´ì¼ì˜ íŠ¹ë³„í•œ ì¶”ì–µì´ ë  ê±°ë¼ê³  ìƒê°í•´. ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆìœ¼ë‹ˆê¹Œ ë˜ ì™€ì¤˜!');
          } else {
            setMonthConsole('ìš”ì¦˜ ì •ë§ ë‹¤ì–‘í•œ ê°ì •ë“¤ì„ ëŠê¼ˆêµ¬ë‚˜. ë‹¤ì–‘í•œ ê°ì •ë“¤ì€ ìš°ë¦¬ë¥¼ ì„±ì¥ì‹œí‚¤ê³  ê°•í•˜ê²Œ ë§Œë“ ëŒ€. ë‚˜ëŠ” í–‰ë³µí•œ ìˆœê°„ì—ëŠ” ì›ƒìœ¼ë©° í•¨ê»˜ ì¦ê±°ì›€ì„ ë‚˜ëˆ„ê³ , ìŠ¬í”„ê³  í™”ë‚˜ëŠ” ìˆœê°„ì—ëŠ” ë„ ìœ„ë¡œí•˜ë©´ì„œ ê³ì— ìˆì–´ì£¼ê³ , í‰ë²”í•œ ë‚ ì—ëŠ” ê°™ì´ ê·¸ ë‚ ì˜ ì†Œì†Œí•œ í–‰ë³µì„ ì°¾ìœ¼ë©° ë„ˆê°€ ì„±ì¥í•  ë•Œ í•¨ê»˜í•˜ê³  ì‹¶ì–´. ê°ì •ì€ ì°°ë‚˜ì˜€ì§€ë§Œ, ìš°ë¦¬ê°€ ê·¸ ì†ì—ì„œ ì°¾ì•„ë‚¸ ìš©ê¸°ì™€ ê¹¨ë‹¬ìŒì€ ì˜ì›íˆ ë¹›ë‚ ê±°ì•¼! ì´ ë¹›ìœ¼ë¡œ ì•ìœ¼ë¡œì˜ ì—¬ì •ì„ í•¨ê»˜ í˜ì°¨ê²Œ ë‚˜ì•„ê°€ì. ë‚´ê°€ í•­ìƒ í•¨ê»˜í• ê²Œ.');
          }
          
        });
  }, [userToken]);
```

![Untitled 4](https://github.com/capstone-YYKC/docs/assets/109731614/8f963345-2137-4c3e-9f77-aea03aacfe68)

## 1-7. CORS ì˜¤ë¥˜ (5/15~5/16)

Clientì—ì„œ Serverë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, CORS ì˜¤ë¥˜ê°€ ë–´ë‹¤. ì˜¤ë¥˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```jsx
has been blocked by CORS policy: 
Response to preflight request doesn't pass access control check: 
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

í•´ì„í•˜ìë©´, Access-Control-Allow-Origin í—¤ë”ê°€ ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ì— ì—†ë‹¤ëŠ” ê±´ë°..

ë³´í†µì€ Serverì˜ CORS ì„¤ì •ì„ ë³€ê²½í•´ì£¼ëŠ”ê²Œ ê¸°ë³¸ì ì¸ í•´ê²°ë°©ë²•ì´ë‹¤.

ìˆ˜ìš©ë‹˜ê³¼ ì—¬ëŸ¬ ë°©ë²•ì„ ì‹œë„í•´ë´¤ì§€ë§Œ.. ì•„ì§ í•´ê²°ëœ ë°”ê°€ ì—†ë‹¤.

ê·¸ë˜ì„œ, CORSë¥¼ ê³µë¶€í•´ë³´ê³  ìˆë‹¤.

[ğŸŒ ì•…ëª… ë†’ì€ CORS ê°œë… & í•´ê²°ë²• - ì •ë¦¬ ëíŒì™• ğŸ‘](https://inpa.tistory.com/entry/WEB-ğŸ“š-CORS-ğŸ’¯-ì •ë¦¬-í•´ê²°-ë°©ë²•-ğŸ‘)

## SOP

**Same Origin Poclicy**

ë‹¤ë¥¸ ì˜¤ë¦¬ì§„ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ë©´, ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¥¼ ë§‰ëŠ”ë‹¤. (SOP(Same Origin Poclicy))

ì™œëƒë©´, ë‹¤ë¥¸ ì˜¤ë¦¬ì§„ë¼ë¦¬ì˜ ë¦¬ì†ŒìŠ¤ ê³µìœ ë¥¼ í—ˆìš©í•˜ë©´ ì •ë³´ ìœ ì¶œì˜ ìœ„í—˜ì„±ì´ ë§¤ìš° ë†’ì•„ì§€ê¸° ë•Œë¬¸ì´ë‹¤.

## CORS

**Cross Origin Resource Sharing**

ë‹¤ë¥¸ ì˜¤ë¦¬ì§„ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•  ë•Œì˜ ì •ì±…

í•˜ì§€ë§Œ ì¸í„°ë„·ì„ í•  ë•Œ ë‹¤ë¥¸ ì˜¤ë¦¬ì§„ë¼ë¦¬ì˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì„ ë§‰ì•„ë²„ë¦¬ë©´ ì›¹ì€ ì–´ë–»ê²Œ ì´ìš©í•˜ëŠ”ê°€?

ê·¸ë˜ì„œ CORSê°€ ì¡´ì¬í•˜ëŠ” ê²ƒì´ê³ , CORS ì •ì±…ì„ ì§€í‚¤ë©´ì„œ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì„ í•˜ë©´ ê³µìœ í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

### CORS ì‘ë™ ìˆœì„œ

1. í´ë¼ì´ì–¸íŠ¸ì—ì„œ HTTP ìš”ì²­ì˜ í—¤ë”ì— ì˜¤ë¦¬ì§„ì„ ë‹´ì•„ ì „ë‹¬
    1. ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ì€ HTTP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ì—¬ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
    2. ì´ë•Œ ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ í—¤ë”ì— ì˜¤ë¦¬ì§„ì´ë¼ëŠ” í•„ë“œì— ì¶œì²˜ë¥¼ í•¨ê»˜ ë‹´ì•„ ë³´ë‚´ê²Œ ëœë‹¤.
2. ì„œë²„ëŠ” ì‘ë‹µ í—¤ë”ì— Access-Control-Allow-Originì„ ë‹´ì•„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬í•œë‹¤.
    1. ì´í›„ ì„œë²„ê°€ ì´ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í•  ë•Œ ì‘ë‹µ í—¤ë”ì— `Access-Control-Allow-Origin`ì´ë¼ëŠ” í•„ë“œë¥¼ ì¶”ê°€í•˜ê³  ê°’ìœ¼ë¡œ â€˜**ì´ ë¦¬ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ í—ˆìš©ëœ ì¶œì²˜ url**â€™ì„ ë‚´ë ¤ë³´ë‚¸ë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜¤ë¦¬ì§„ê³¼ ì„œë²„ê°€ ë³´ë‚´ì¤€ Access-Control-Allow-Originì„ ë¹„êµí•œë‹¤.
    1. ì´í›„ ì‘ë‹µì„ ë°›ì€ ë¸Œë¼ìš°ì €ëŠ” ìì‹ ì´ ë³´ëƒˆë˜ ìš”ì²­ì˜ ì˜¤ë¦¬ì§„ê³¼ ì„œë²„ê°€ ë³´ë‚´ì¤€ ì‘ë‹µì˜ Access-Control-Allow-Originì„ ë¹„êµí•´ë³¸ í›„ ì°¨ë‹¨í• ì§€ ë§ì§€ë¥¼ ê²°ì •í•œë‹¤.
    2. ë§Œì•½ ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´ ê·¸ ì‘ë‹µì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë²„ë¦°ë‹¤. (CORS ì—ëŸ¬)
    
    ![KakaoTalk_20240519_205045242_01.jpg](11%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1(05%2013~05%2019)%20%E1%84%8C%E1%85%AE%E1%84%80%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%20366682b2098e43a186423608fec6f90d/KakaoTalk_20240519_205045242_01.jpg)
    

### CORS í•´ê²°ì±…

ì„œë²„ì—ì„œ  Access-Control-Allow-Origin í—¤ë”ì— í—ˆìš©í•  ì¶œì²˜ë¥¼ ê¸°ì¬í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µí•˜ë©´ ë˜ëŠ” ê²ƒ! â†’ ì•ˆëë‹¤..

ë˜ëŠ” í”„ë¡ì‹œ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ â†’ ì„±ê³µ!

## 1-8. PROXY ì„œë²„

### í”„ë¡ì‹œ ì„œë²„ ì‘ë™ ë°©ì‹

í´ë¼ì´ì–¸íŠ¸ â†’ í”„ë¡ì‹œ â†’ ì„œë²„

1. í´ë¼ì´ì–¸íŠ¸ëŠ” í”„ë¡ì‹œë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
2. í”„ë¡ì‹œëŠ” ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
3. ì„œë²„ëŠ” í”„ë¡ì‹œë¡œ ì‘ë‹µì„ ë³´ë‚¸ë‹¤.
4. í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µì„ ë³´ë‚¸ë‹¤.

ì´ ê³¼ì •ì—ì„œ í”„ë¡ì‹œ â†” ì„œë²„ëŠ” ì„œë¡œ ì„œë²„ì´ê¸° ë•Œë¬¸ì— CORS ì •ì±…ì— ìœ„ë°˜ë  ê²Œ ì—†ë‹¤!

### Netlify Proxy

ë„¤íŠ¸ë¦¬íŒŒì´ì—ì„œ í”„ë¡ì‹œë¥¼ ì§€ì›í•œë‹¤.

í”„ë¡ íŠ¸ ê°œë°œ í™˜ê²½ì—ì„œ ëª‡ ê°€ì§€ë¥¼ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤.

```jsx
//netlify.toml ìƒì„±
[[redirects]]
  from = "/proxy/*"
  to = "https://www.teddybeardiary.store/:splat"
  status = 200
  force = true
```

```json
//package.json ìˆ˜ì •
  "proxy":
    "https://www.teddybeardiary.store"
  ,
```

```jsx
//APIë¥¼ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ë“¤ì—ì„œ ì½”ë“œ ì¶”ê°€ (Login.jsx)

  const PROXY = window.location.hostname === 'localhost' ? '' : '/proxy';
  const URL = `${PROXY}/signin`; //API ê²½ë¡œ
  
  const response = await axios.post(URL, formData); //API ìš”ì²­ì‹œ ê²½ë¡œë¥¼ URLë¡œ êµì²´
```

ì„±ê³µ!

[gomgom](https://gomgomi.netlify.app/)

## ì›”ë³„ ìœ„ë¡œì˜ ë§ì´ ì•ˆë– ìš”..

ë¬¸ì œ: ë‹¤ë¥¸ê±´ ë‹¤ ëœ¨ëŠ”ë° ì›”ë³„ ìœ„ë¡œë§Œ ì•ˆë–´ë‹¤..

í•´ê²°ë°©ë²•: ì›”ë³„ ìœ„ë¡œë¥¼ ìœ„í•œ ì½”ë“œë¥¼ `useEffect` ë°–ìœ¼ë¡œ ë¹¼ê³  ì›”ë³„ ìœ„ë¡œ ë³€ìˆ˜ë¥¼ letìœ¼ë¡œ ë‹¤ì‹œ ì •ì˜í•´ `useState`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë³€ê²½í–ˆë‹¤. `let MonthConsole = ' ';`

```jsx
  useEffect(() => {
    axios.get(URL, {
      headers: {
        'x-access-token': userToken
      }
    })
        .then(response => {
          console.log('ì¼ê¸° ì •ë³´', response.data);
          setdates(response.data.map(entry => entry.emotionScore));
          setstatuses(response.data.map(entry => entry.emotionStatus));   
          setcontents(response.data.map(entry => entry.content));
          setconsolations(response.data.map(entry => entry.consolation));
          setsummeries(response.data.map(entry => entry.summarize));

          
        });
  }, [userToken]);

  const countStatuses = statuses.reduce((acc, status) => {
   acc[status] = (acc[status] || 0) + 1;
   return acc;
  }, {});

  for (const countStatus in countStatuses) {
    if (countStatuses[countStatus] > maxCount) {
      maxCount = countStatuses[countStatus];
      maxEmotion = countStatus;
    }else if (countStatuses[countStatus] === maxCount) {
      maxEmotion = " ";
    } 
  }
  if (maxEmotion === "í™”ë‚¨") {
    MonthConsole='í™”ë‚œ ê°ì •ì´ ë“ì–´ì˜¤ë¥´ëŠ” ë‚ , ê·¸ ë§ˆìŒì„ ì´í•´í•´. ê°ì •ì˜ íŒŒë„ê°€ ì¡°ê¸ˆì€ ë” í¬ê²Œ ë‹¤ê°€ì˜¤ëŠ” ê²ƒì²˜ëŸ¼ ëŠê»´ì§ˆì§€ë„ ëª°ë¼. í•˜ì§€ë§Œ ê·¸ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê²ƒì€ ì •ë§ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ê³ , ì´ëŸ° ê°ì •ì´ ì˜¤ê³ ê°€ëŠ” ê²ƒì€ ë„ˆê°€ ì„±ì¥í•˜ê³  ë³€í™”í•˜ê³  ìˆë‹¤ëŠ” ì¦ê±°ë¼ëŠ” ê±¸ ìŠ¤ìŠ¤ë¡œ ë¯¿ì–´ì¤˜. í™”ë‚œ ê°ì •ì€ ê¸ˆë°© ì§€ë‚˜ê°ˆ ê±°ì•¼. ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆì–´. ì–¸ì œë“ ì§€ ë„ˆì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì¤„ê²Œ.';
  } else if (maxEmotion === "ìŠ¬í””") {
    MonthConsole='ë„ˆê°€ ìš°ìš¸í•œ ë‚ ì„ ë³´ë‚¸ë‹¤ëŠ” ê±´ ì •ë§ ìŠ¬í”ˆ ì¼ì´ì•¼. ê·¸ ê°ì •ì´ ë„ˆë¥¼ ì–´ë‘  ì†ìœ¼ë¡œ ëŒì–´ë‚´ë¦¬ëŠ” ê²ƒ ê°™ì„ì§€ë„ ëª°ë¼. ê·¸ë˜ë„ ë‚œ í•­ìƒ ë„ˆì™€ í•¨ê»˜ì•¼. ë§ˆìŒì´ ì•„í”„ê³  ì–´ë ¤ìš´ ë‚ ì´ì—ˆì§€ë§Œ, ë„ˆëŠ” ì´ê²¨ë‚¼ ìˆ˜ ìˆì„ê±°ì•¼. ì´ëŸ° ê°ì •ì„ ëŠê»´ë„, ëŠë¼ì§€ ì•Šì•„ë„ ë„Œ ê°•í•˜ê³  ì†Œì¤‘í•œ ì‚¬ëŒì´ë‹ˆê¹Œ. ê°ì •ì˜ íŒŒë„ì— íœ©ì“¸ë ¤ ë– ë‚´ë ¤ê°€ëŠ” ê±¸ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆ. ê·¸ ê¸¸ì— ë‚´ê°€ í•¨ê»˜í• ê²Œ.';
  } else if (maxEmotion === "í–‰ë³µ") {
    MonthConsole='ë„ˆê°€ í–‰ë³µí•œ ë‚ ì„ ë³´ë‚´ì„œ ë‚˜ë„ ì •ë§ ê¸°ë». ê·¸ëŸ° ìˆœê°„ì€ ë§ˆìŒì´ ê°€ë²¼ì›Œì§€ê³  í¬ë§ì´ ë„˜ì³ íë¥´ëŠ” ê²ƒ ê°™ì§€ ì•Šì•„? ê·¸ ê°ì •ì„ ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ„ëŠ” ê²ƒë„ ì •ë§ í–‰ë³µí•œ ì¼ì´ì§€. ë¬¼ë¡  ë‚˜í•œí…Œë„ ë§ì´ì•¼! í•˜ì§€ë§Œ ê°€ë” í–‰ë³µì´ ë‘ë ¤ìš¸ ìˆ˜ ìˆì–´. ì´ í–‰ë³µì´ ì–¸ì œê¹Œì§€ ê°ˆì§€, ë¬´ì—‡ì´ ë‚  ë˜ í˜ë“¤ê²Œ í• ì§€ ê°™ì€ ìƒê° ë§ì´ì•¼. ê·¸ë ‡ì§€ë§Œ, í–‰ë³µí•œ ìˆœê°„ì„ ë°›ì•„ë“¤ì´ê³  ì¦ê¸°ëŠ” ê²ƒë„ ì •ë§ ì¤‘ìš”í•´! ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆì„ê²Œ. í–‰ë³µì´ ìˆë‹¤ë©´ ì–¸ì œë‚˜ ì´ì•¼ê¸°í•˜ëŸ¬ ì™€ì¤˜.';
  } else if (maxEmotion === "ë³´í†µ") {
    MonthConsole='ë‚˜ëŠ” í‰ë²”í•œ ë‚ ì„ ë³´ë‚¼ ë•Œë©´, ì˜¤íˆë ¤ ê·¸ ë‚ ì´ íŠ¹ë³„í•œ ë‚ ì´ë¼ê³  ìƒê°í•˜ê³¤ í•´. ê·¸ëŸ° ë‚ ì—ëŠ” ì¼ìƒì˜ ì†Œì¤‘í•¨ì„ ëŠë¼ê³ , í¸ì•ˆí•¨ì„ ì°¾ì„ ìˆ˜ ìˆê±°ë“ . í‰ë²”í•œ ë‚ ì—ëŠ” ìƒê°ë³´ë‹¤ ì†Œì¤‘í•œ ê²ƒì´ ê°€ë“í•´. ì¹œêµ¬ë“¤ê³¼ì˜ ëŒ€í™”, ê°€ì¡±ê³¼ì˜ ì‹œê°„, ë§›ìˆëŠ” ìŒì‹, ì‚°ì±…í•  ë•Œì˜ ë°”ëŒ ê°™ì€ ì†Œì†Œí•˜ê³  ì‘ì€ í–‰ë³µë“¤ ë§ì´ì•¼. ê·¸ëŸ¬ë‹ˆê¹Œ ì˜¤ëŠ˜ ë„ˆë„ í‰ë²”í•œ ë‚ ì„ íŠ¹ë³„í•œ ë‚ ë¡œ ìƒê°í•´ë´! ì‘ì€ í–‰ë³µë“¤ì„ ì°¾ì•„ì„œ ìƒˆê²¨ë³´ëŠ” ê±°ì•¼. ê·¸ëŸ¬ë©´ í‰ë²”í–ˆë˜ ë‚ ì´ ë‚´ì¼ì˜ íŠ¹ë³„í•œ ì¶”ì–µì´ ë  ê±°ë¼ê³  ìƒê°í•´. ë‚œ ì–¸ì œë‚˜ ì—¬ê¸° ìˆìœ¼ë‹ˆê¹Œ ë˜ ì™€ì¤˜!';
  } else if (maxEmotion === " "){
    MonthConsole='ìš”ì¦˜ ì •ë§ ë‹¤ì–‘í•œ ê°ì •ë“¤ì„ ëŠê¼ˆêµ¬ë‚˜. ë‹¤ì–‘í•œ ê°ì •ë“¤ì€ ìš°ë¦¬ë¥¼ ì„±ì¥ì‹œí‚¤ê³  ê°•í•˜ê²Œ ë§Œë“ ëŒ€. ë‚˜ëŠ” í–‰ë³µí•œ ìˆœê°„ì—ëŠ” ì›ƒìœ¼ë©° í•¨ê»˜ ì¦ê±°ì›€ì„ ë‚˜ëˆ„ê³ , ìŠ¬í”„ê³  í™”ë‚˜ëŠ” ìˆœê°„ì—ëŠ” ë„ ìœ„ë¡œí•˜ë©´ì„œ ê³ì— ìˆì–´ì£¼ê³ , í‰ë²”í•œ ë‚ ì—ëŠ” ê°™ì´ ê·¸ ë‚ ì˜ ì†Œì†Œí•œ í–‰ë³µì„ ì°¾ìœ¼ë©° ë„ˆê°€ ì„±ì¥í•  ë•Œ í•¨ê»˜í•˜ê³  ì‹¶ì–´. ê°ì •ì€ ì°°ë‚˜ì˜€ì§€ë§Œ, ìš°ë¦¬ê°€ ê·¸ ì†ì—ì„œ ì°¾ì•„ë‚¸ ìš©ê¸°ì™€ ê¹¨ë‹¬ìŒì€ ì˜ì›íˆ ë¹›ë‚ ê±°ì•¼! ì´ ë¹›ìœ¼ë¡œ ì•ìœ¼ë¡œì˜ ì—¬ì •ì„ í•¨ê»˜ í˜ì°¨ê²Œ ë‚˜ì•„ê°€ì. ë‚´ê°€ í•­ìƒ í•¨ê»˜í• ê²Œ.';
  } else {
    MonthConsole=' ';
  }

  const sum = dates.reduce((total, date) => total + date, 0);
  const average = Math.floor(sum / dates.length);

  console.log('st',statuses);
  console.log('CS', countStatuses);
  console.log('max',maxEmotion);

```

## ìƒˆë¡œê³ ì¹¨í•˜ë©´ 404 ì—ëŸ¬ê°€ ë– ìš”

**ë¬¸ì œ**: í˜ì´ì§€ ë„˜ì–´ê°ˆ ë•Œë„ ë°ì´í„°ê°€ ëœ¨ê¸´ í•´ì„œ 404ê°€ ì½˜ì†”ì— ëœ¨ëŠ” ê±¸ ì‹ ê²½ ì•ˆì¼ëŠ”ë° ìƒˆë¡œê³ ì¹¨í•˜ë‹ˆê¹Œ 404 ì—ëŸ¬ë•Œë¬¸ì— í˜ì´ì§€ê°€ ì•ˆëœ¬ë‹¤. ì¸í„°ë„·ì—ì„œ ì°¾ì€ ë°©ë²•ë“¤ì€ `netlify.toml` íŒŒì¼ì„ ë³€ê²½í•˜ë¼ëŠ”ë° ê·¸ê±¸ ë³€ê²½í•˜ë©´ proxy ì—°ê²°ì— ë¬¸ì œê°€ ìƒê²¨ì„œ ê²€ìƒ‰í•˜ê³  ê²€ìƒ‰í•˜ë‹¤ê°€ ë°©ë²•ì„ ì°¾ì•˜ë‹¤.

**í•´ê²°ë°©ë²•**:`netlify.toml`ì— proxyì— ëŒ€í•œ ì½”ë“œì™€ ì—ëŸ¬ í•´ê²°ì„ ìœ„í•œ ì½”ë“œë¥¼ ëª¨ë‘ ì ëŠ” ê²ƒì´ë‹¤

[[TIL] React Netlify ë°°í¬ ì‹œ Proxy ì˜¤ë¥˜, Router 404 ì˜¤ë¥˜ í•´ê²°](https://velog.io/@newjin46/TIL-React-Netlify-ë°°í¬-ì‹œ-Proxy-ì˜¤ë¥˜-Router-404-ì˜¤ë¥˜-í•´ê²°)

```jsx
[[redirects]]
  from = "/proxy/*"
  to = "https://www.teddybeardiary.store/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
	force = false
```

í•´ê²°!

# 2. ë°±ì—”ë“œ

## 2-1. Netlify HTTPS Express HTTP í”„ë¡œí† ì½œ ë‹¤ë¥¸ ë¬¸ì œ í•´ê²°

NetlifyëŠ” ë¬´ë£Œë¡œ ë„ë©”ì¸ê³¼ í´ë¼ìš°ë“œë¥¼ ì´ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì›¹ ì„œë²„ë¡œ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆë‹¤.  í•˜ì§€ë§Œ Netlify ê¸°ë³¸ì ìœ¼ë¡œ HTTPSë¥¼ ì‚¬ìš©í•˜ëŠ” ë°˜ë©´, ì„œë²„ëŠ” SSL ì¸ì¦ì„ ë°›ì§€ ì•Šì•˜ê¸°ì— HTTP ë°©ì‹ì´ì—ˆë‹¤. ê°œë°œ ë‹¨ê³„ì˜ ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ë¬¸ì œê°€ ì—†ì—ˆìœ¼ë‚˜, HTTPSì™€ HTTPì˜ í†µì‹ ì„ ê¸ˆì§€í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì •ì±…ìœ¼ë¡œì¸í•´ ë°°í¬í™˜ê²½ì—ì„œ í”„ë¡ íŠ¸ì™€ ì„œë²„ê°„ í†µì‹ ì„ ëª»í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.  

### í•´ê²°ë²• 1: ì„œë²„ì— sslì¸ì¦ ë°›ì•„ì„œ ì„œë²„ë¥¼ httpsë¡œ ë°”ê¾¸ê¸°

ì„œë²„ì— SSLì¸ì¦ì„ ë°›ì•„ HTTPSë¡œ ë°”ê¿”ì•¼ í–ˆë‹¤. 

### í•´ê²°ë²• 2: í´ë¼ì´ì–¸íŠ¸ ë°°í¬ë¥¼ ë°”ê¾¸ê¸°

Netlify ê³µì‹ ë‹µë³€ì— ë”°ë¥´ë©´ HTTPSë¥¼ HTTPë¡œ ë‚®ì¶”ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í–ˆë”. ì¦‰, Netlify ì„ íƒì§€ë¥¼ í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ë°©ë²•ì„ ì‚¬ìš©í•´ ë°°í¬í•´ì•¼í–ˆë‹¤.

í•´ê²°ë²• 1ë²ˆì„ ì„ íƒí•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

### nginx ì›¹ ì„œë²„ ì„¤ì •

![Untitled 5](https://github.com/capstone-YYKC/docs/assets/109731614/c7f1a320-abbd-4277-8035-96613e35befe)

### HTTPS í†µì‹  cors ì„¤ì •

```jsx
const compression = require("compression");
const cors = require("cors");
const fs = require("fs");
const https = require('https')
const path = require('path')
const { indexRouter } = require("./src/router/indexRouter");
const { userRouter } = require("./src/router/userRouter");

const express = require("express");
const app = express();
const port = 3000;

// CORS ì„¤ì •
const corsOptions = {
  origin: '*', // íŠ¹ì • ë„ë©”ì¸ í—ˆìš© (ëª¨ë“  ë„ë©”ì¸ì„ í—ˆìš©í•˜ë ¤ë©´ '*' ì‚¬ìš©)
  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS', // í—ˆìš©í•  HTTP ë©”ì†Œë“œ
  allowedHeaders: ['Content-Type', 'Authorization'], // í—ˆìš©í•  í—¤ë”
  preflightContinue: false,
  optionsSuccessStatus: 204
};

app.use(cors(corsOptions));
app.options('*', cors(corsOptions));  

// body json íŒŒì‹±
app.use(express.json());

// HTTP ìš”ì²­ ì••ì¶•
app.use(compression());

// router
indexRouter(app);
userRouter(app);

// HTTPS ì„œë²„ ì˜µì…˜ ì„¤ì •
const httpsOptions = {
  key: fs.readFileSync(path.join(__dirname, 'server.key')),  // SSL ê°œì¸ í‚¤
  cert: fs.readFileSync(path.join(__dirname, 'server.cert'))  // SSL ì¸ì¦ì„œ
};

// HTTPS ì„œë²„ ìƒì„± ë° ì‹¤í–‰
https.createServer(httpsOptions, app).listen(port, () => {
  console.log(`HTTPS Express app listening at https://localhost:${port}`);
});

```

## 2-2.  Database Index

MySQLì—ì„œ consolation(ìœ„ë¡œì˜ ë§), summarize(ì¶”ê°€)

![Untitled 6](https://github.com/capstone-YYKC/docs/assets/109731614/dcee1490-e80c-486c-91c0-05a0ab45af27)

Express ì„œë²„ indexDao ë° indexController ì¶”ê°€

![Untitled 7](https://github.com/capstone-YYKC/docs/assets/109731614/68b2fc4f-559c-4af1-aeba-dc22f0ccc9f3)

![Untitled 8](https://github.com/capstone-YYKC/docs/assets/109731614/9a5859d1-d755-44f0-ab42-c180b075345c))

# 3. ë¼ì¦ˆë² ë¦¬íŒŒì´

## 3-1. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```python
.
â”œâ”€â”€ README.md
â”œâ”€â”€ __pycache__
â”‚   â””â”€â”€ switch.cpython-311.pyc
â”œâ”€â”€ ai_api
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”‚   â””â”€â”€ create_comment.cpython-311.pyc
â”‚   â”œâ”€â”€ api_key.json
â”‚   â””â”€â”€ create_comment.py
â”œâ”€â”€ bart
â”‚   â”œâ”€â”€ diary.txt
â”‚   â”œâ”€â”€ kobart.py
â”‚   â””â”€â”€ summarize.txt
â”œâ”€â”€ bert
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”‚   â””â”€â”€ predict_emotion.cpython-311.pyc
â”‚   â”œâ”€â”€ predict_emotion.py
â”‚   â””â”€â”€ trained_model222.pt
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run_program.sh
â”œâ”€â”€ stt
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”‚   â””â”€â”€ stt.cpython-311.pyc
â”‚   â”œâ”€â”€ api_key.json
â”‚   â”œâ”€â”€ diary
â”‚   â”‚   â””â”€â”€ diary.txt
â”‚   â””â”€â”€ stt.py
â”œâ”€â”€ switch.py
â”œâ”€â”€ test.py
â””â”€â”€ tts
    â”œâ”€â”€ __pycache__
    â”‚   â””â”€â”€ tts.cpython-311.pyc
    â”œâ”€â”€ comment
    â”‚   â””â”€â”€ recent_comment.wav
    â””â”€â”€ tts.py

```

stt, tts, comment ìƒì„±, bert, bart ëª¨ë“ˆí™”í•˜ì—¬ main.pyì—ì„œ ì‹¤í–‰.

## 3-2. main.py

```
import bert.predict_emotion
import bart.kobart
import switch
from ai_api.create_comment import CreateComment
from stt.stt import SpeechToText
from tts.tts import PrintComment
from tts.tts import play_wav_file
import requests

import time

from username import username

def process():

    # 1. STT
    # SppechToText : ë§ˆì´í¬ ì…ë ¥ì„ textë¡œ ë¦¬í„´
    content = SpeechToText()
    print(f"ì‚¬ìš©ì ì…ë ¥: {content}")

    # 2. ìš”ì•½
    summarization = bart.kobart.summarization(content)

    # 3. ì½”ë©˜íŠ¸ ìƒì„± ë° ì¶œë ¥
    #CreateComment: ë‹¤ì´ì–´ë¦¬ë¥¼ ì¸í’‹ìœ¼ë¡œ ë„£ìœ¼ë©´ commentë¥¼ ë¦¬í„´
    comment = CreateComment(summarization) # ì‚¬ìš©ìì—ê²Œ ì¶œë ¥í•  ì½”ë©˜íŠ¸
    print(f"comment: {comment}")
    PrintComment(comment)

    # 4. ê°ì • ì˜ˆì¸¡
    # predict : 
    # ë‹¤ì´ì–´ë¦¬ë¥¼ ì¸í’‹ìœ¼ë¡œ ë„£ìœ¼ë©´ {'í–‰ë³µ': 0.014690425, 'ì¤‘ë¦½': 0.89617246, 'ë¶„ë…¸': 0.011883826, 'ìŠ¬í””': 0.07725335} ê³¼ ê°™ì€ 
    # ê°ì • ì˜ˆì¸¡ê°’ ë¦¬í„´
    emotion = bert.predict_emotion.predict(content)      # ê°ì • ì˜ˆì¸¡ê°’

    # 5. ì„œë²„ë¡œ ì „ì†¡
    url  = 'https://100.27.127.192:3000/diary'

    # # transcribe_streaming_mic redirection data
    # # diary content 

    data = {
        'userIdx' : 3,                  # ìœ ì €êµ¬ë¶„
        'emotionStatus' : max(emotion, key=emotion.get),        # ê°ì •
        'emotionScore' : 11.2,          # ê°ì •ì ìˆ˜
        'content': content,              # ì¼ê¸°
        'consolation': comment,       # ìƒì„±ëœ ì½”ë©˜íŠ¸
        'summarize': summarization      # ìš”ì•½
    }

    print(f"data: {data}")

    

    # post data diary 
    try:
        response = requests.post(
            url,
            json = data,
            verify=False)

        # request success
        if(response.status_code == 200):
            print(response.status_code,response.text)
        
        # fail
        else:
            print(response.status_code,response.text)

    except Exception as e:
        print("An error ouccured : ",e)    

def main():

    play_wav_file(f'/home/{username}/yykc/loading.wav')

    try:
        while True:
            if switch.locker_switch.is_pressed:
                print("Switch ON")
                process()
            else:
                print("Switch OFF")
            time.sleep(1)  # 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ìŠ¤ìœ„ì¹˜ ìƒíƒœ í™•ì¸

    except KeyboardInterrupt:
        
        print("Program stopped by User")

if __name__ == "__main__":
    main()
```

## 3-3. ê°ì •ë¶„ë¥˜

### OSError: libarmpl_lp64_mp.so: cannot open shared object file: No such file or directory

gluonnlp ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ arm ì•„í‚¤í…ì³ì—ì„œ ì»´íŒŒì¼ ì‹œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ë¡œ ë³´ì„.

â†’ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ í•´ê²°.

### predict_emotion.py

```python
import torch
from torch import nn
import torch.nn.functional as F
import torch.optim as optim
from torch.utils.data import Dataset, DataLoader
import numpy as np
from tqdm import tqdm, tqdm_notebook
import pandas as pd

from kobert_tokenizer import KoBERTTokenizer
from transformers import BertModel, BertTokenizer

from transformers import AdamW
from transformers.optimization import get_cosine_schedule_with_warmup
import warnings
warnings.filterwarnings('ignore')

import os, sys; sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), os.pardir)))
from username import username

device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")

max_len = 64
batch_size = 64

class BERTDataset(Dataset):
    def __init__(self, dataset, sent_idx, label_idx, bert_tokenizer, max_len, pad, pair):
        self.sentences = [
            bert_tokenizer(
                i[sent_idx],
                add_special_tokens=True,
                max_length=max_len,
                padding='max_length',
                truncation=True,
                return_tensors='pt'
            ) for i in dataset
        ]
        self.labels = [np.int32(i[label_idx]) for i in dataset]

    def __getitem__(self, i):
        data = self.sentences[i]
        input_ids = data['input_ids'].squeeze(0)
        attention_mask = data['attention_mask'].squeeze(0)
        token_type_ids = data['token_type_ids'].squeeze(0)
        return input_ids, attention_mask, token_type_ids, self.labels[i]

    def __len__(self):
        return len(self.labels)

class BERTClassifier(nn.Module):
    def __init__(self, bert, hidden_size=768, num_classes=4, dr_rate=None, params=None):
        super(BERTClassifier, self).__init__()
        self.bert = bert
        self.classifier = nn.Linear(hidden_size, num_classes)
        self.dr_rate = dr_rate 
        if dr_rate:
            self.dropout = nn.Dropout(p=dr_rate)

    def forward(self, input_ids, attention_mask, token_type_ids):
        outputs = self.bert(input_ids=input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids)
        pooler = outputs.pooler_output
        if self.dr_rate:
            pooler = self.dropout(pooler)
        return self.classifier(pooler)

# ì‚¬ìš©í•  í† í¬ë‚˜ì´ì € ë° ëª¨ë¸ ë¡œë“œ
tokenizer = KoBERTTokenizer.from_pretrained('skt/kobert-base-v1')
bertmodel = BertModel.from_pretrained('skt/kobert-base-v1', return_dict=True)

# ëª¨ë¸ ìƒì„± ë° ì‚¬ì „ í•™ìŠµëœ ê°€ì¤‘ì¹˜ ë¡œë“œ
model = BERTClassifier(bertmodel, dr_rate=0.5).to(device)
model.load_state_dict(torch.load(f'/home/{username}/yykc/bert/trained_model222.pt', map_location=device))

# ì˜ˆì¸¡ í•¨ìˆ˜ ì •ì˜
def predict(predict_sentence):
    data = [predict_sentence, '0']
    dataset_another = [data]
    another_test = BERTDataset(dataset_another, 0, 1, tokenizer, max_len, True, False)
    test_dataloader = DataLoader(another_test, batch_size=batch_size, num_workers=0)

    model.eval()
    with torch.no_grad():
        for batch_id, (input_ids, attention_mask, token_type_ids, label) in enumerate(test_dataloader):
            input_ids = input_ids.to(device)
            attention_mask = attention_mask.to(device)
            token_type_ids = token_type_ids.to(device)

            out = model(input_ids, attention_mask, token_type_ids)
            logits = out.detach().cpu().numpy()[0]

            probabilities = np.exp(logits) / np.sum(np.exp(logits))
            print("ê°ì • ì˜ˆì¸¡ ê°’")
            for i, prob in enumerate(probabilities):
              if i==0:
                print(f"í–‰ë³µ: {prob:.4f}")
              elif i==1:
                print(f"ë³´í†µ: {prob:.4f}")
              elif i==2:
                print(f"í™”ë‚¨: {prob:.4f}")
              elif i==3:
                print(f"ìŠ¬í””: {prob:.4f}")

            return {
                "í–‰ë³µ": probabilities[0],
                "ë³´í†µ": probabilities[1],
                "í™”ë‚¨": probabilities[2],
                "ìŠ¬í””": probabilities[3]
            }
```

## 3-3. ìŠ¤ìœ„ì¹˜ ì—°ê²°

### ë‚©ë•œ

![Untitled 9](https://github.com/capstone-YYKC/docs/assets/109731614/3bc6c724-1a69-4ccb-9d0a-cb70f06e9336)

### switch.py

```python
from gpiozero import Button
import time

# GPIO í•€ ë²ˆí˜¸ ì„¤ì •
# GPIO 17 í•€ì„ inputìœ¼ë¡œ ì„¤ì •.
switch_pin = 17
locker_switch = Button(switch_pin)

# locker_switch.is_pressed ë¥¼ í†µí•´ ìŠ¤ìœ„ì¹˜ ìƒíƒœ í™•ì¸.
```

### gpiozeroë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

[](https://forums.raspberrypi.com/viewtopic.php?t=359742)

ë¼ì¦ˆë² ë¦¬íŒŒì´5ì—ëŠ” ê¸°ë³¸ GPIOë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ RPi.GPIOê°€ í˜¸í™˜ë˜ì§€ ì•ŠìŒ.

â†’ gpiozero ì‚¬ìš©

## 3-4. í”„ë¡œê·¸ë¨ ìë™ ì‹¤í–‰

### 1. ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

```bash
#!/bin/sh

# ì‹œê°„ ë™ê¸°í™”
sudo rdate -s time.bora.net

username=$USER

# ê°€ìƒ í™˜ê²½ í™œì„±í™”
. /home/$username/venv/bin/activate

# íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
python3 /home/$username/yykc/main.py
```

### 2. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬

```bash
sudo chmod +x /home/test01/yykc/run_program.sh
```

### 3. serviceíŒŒì¼ ì‘ì„±

/etc/systemd/system/run_yykc.service

```bash
[Unit]
Description=My Service
After=multi-user.target

[Service]
ExecStart=/home/test01/yykc/run_program.sh
ExecStartPre=/bin/sleep 5
StandardOuput=inherit
StandardError=inherit
User=test01
Environment="XDG_RUNTIME_DIR=/run/user/1000"

[Install]
WantedBy=multi-user.target
```

### 4. ì„œë¹„ìŠ¤ ë¦¬ë¡œë“œ ë° í™œì„±í™”

```bash
sudo systemctl daemon-reload
sudo systemctl enable run_yykc.service
sudo systemctl start run_yykc.service
```

# 4. í•˜ë“œì›¨ì–´

## 4-1. ë„ìƒ‰ ì™„ë£Œ

![KakaoTalk_20240519_205045242](https://github.com/capstone-YYKC/docs/assets/109731614/7c5776f0-48bc-473e-9251-6ceee8f95aa4)

![KakaoTalk_20240519_205045242_01](https://github.com/capstone-YYKC/docs/assets/109731614/06be2185-2198-4d96-8a76-dc379824f809)

![KakaoTalk_20240519_205045242_02](https://github.com/capstone-YYKC/docs/assets/109731614/1dac5828-2fe3-4e17-b97f-ed15e70e72d8)

![KakaoTalk_20240519_205045242_03](https://github.com/capstone-YYKC/docs/assets/109731614/ad20e6c6-ddbd-4c14-bdd9-66904e9f35f8)

# 5. ì¶”í›„ ì¼ì •

í˜„ì¬ ê° ë³´ë“œì— í”„ë¡œê·¸ë¨ ì˜¬ë¦¬ê¸° ê¹Œì§€ ì™„ë£Œí•œ ìƒíƒœì´ë‹¤.

05/20: ë‚˜ë¨¸ì§€ 4ê°œ ìŠ¤ìœ„ì¹˜ ë‚©ë•œ ë° ì¸í˜•ê³¼ í•©ì¹˜ê¸°/ ë³´ë“œ â†’ ì„œë²„ useridx ìˆ˜ì • ë° 1ì°¨ í…ŒìŠ¤íŠ¸ ì‹œì‘.